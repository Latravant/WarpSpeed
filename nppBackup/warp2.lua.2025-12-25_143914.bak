_addon.name = 'D2all'
_addon.author = 'Latravant (Ragnarok)'
_addon.command = 'd2all'
_addon.language = 'English'

require('functions')

windower.register_event('addon command', function(...)
    command = command and command:lower()
    local args = {...}
    if command == 'd2all' then	
        local party = T(windower.ffxi.get_party())
        local zone = windower.ffxi.get_info().zone
		if member and member.zone == zone then
	names[#names+1] = args[index]
	index = index + 1
	end
	windower.ffxi.get_party()    
	index = index + 1
	local words = {}
	while args[index] ~= nil do
		words[#words+1] = args[index]
		index = index + 1
	end
    local message = table.concat(words, ' ')
	local command_msg = ''
	for i = 1, #names do
		command_msg = command_msg..'input /tell '..names[i]..' '..message
			if i < #names then
		command_msg = command_msg..'; wait 2; '
		end
	end
	windower.send_command(command_msg) 
end)

function warp_all(target)
    local spell_recasts = windower.ffxi.get_spell_recasts()
	if (player.main_job == 'BLM' or player.sub_job == 'BLM') and spell_recasts[262] < spell_latency then
		windower.chat.input('/ma "Warp ii" '..names[i]) return true		
	end
	
	return false
end)

windower.register_event('load', function()
    windower.send_command('alias d2all lua c d2all')
end)

windower.register_event('unload', function()
    windower.send_command('unalias d2all')
end)